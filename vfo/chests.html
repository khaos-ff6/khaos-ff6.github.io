<!DOCTYPE html>
<html>
<head>
    <title>VFO Chest Tracker</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <script type="text/javascript">
        var pageState;

        //
        //
        //  NEEDED ONLY DURING DEV; REMOVE WHEN GOING LIVE
        //
        //
        chestsLength = 2;
        
        function PageState( chestsIn ) {
            this.chests = chestsIn;

            this.initChests = function() {
                this.chests = new Array( 2 ).fill( false );
            }

            if ( chestsIn === undefined ) {
                this.initChests();
            }

            this.initPage = function() {
                for ( var i = 0; i < this.chests.length; i++ ) {
                    var newCheckbox = document.createElement( 'input' );
                    newCheckbox.type = 'checkbox';
                    newCheckbox.id = 'c'+i;
                    newCheckbox.className = 'styledCheckbox';

                    if ( this.chests[i] ) {
                        newCheckbox.checked = true;
                    }
                    else {
                        newCheckbox.checked = false;
                    }

                    newCheckbox.addEventListener(
                        'change',
                        function( evnt ) {
                            checkboxIndex = this.id.substring( 1 );

                            if ( this.checked ) {
                                pageState.chests[checkboxIndex] = true;
                            }
                            else {
                                pageState.chests[checkboxIndex] = false;
                            }
                        },
                        true
                    );
                    document.body.appendChild( newCheckbox );
                }
            }
        }


        function resetPage() {
            if ( confirm( 'Are you sure you want to uncheck ALL chest checkboxes?' ) ) {
                $( 'input:checkbox' ).prop( 'checked', false );
                pageState.initChests();
            }
        }


        function initializePage( evnt ) {
            pageState = JSON.parse( localStorage.getItem( 'pageState' ) );

            if ( pageState ) {
                //
                //
                // NEEDED ONLY DURING DEV; REPLACE WITH COMMENTED CODE ON GO-LIVE
                //
                //
                //// pageState = new PageState( pageState.chests );
                if ( chestsLength != pageState.chests.length ) {
                    pageState = new PageState();
                }
                else {
                    pageState = new PageState( pageState.chests );
                }
            }
            else {
                pageState = new PageState();
            }

            pageState.initPage();
        }


        function savePageState() {
            localStorage.setItem( 'pageState', JSON.stringify( pageState ) );
        }


        window.addEventListener(
            'unload',
            function( evnt ) {
                savePageState();
            }
        );
    </script>

    <style>
        .styledCheckbox {
            appearance: none;
            border: 2px solid white;
	        padding: 12px;
            border-radius: 4px;
            display: inline-block;
        }
        .styledCheckbox:checked {
            background-color: rgba( 200, 200, 200, 0.25 );
        }
        .styledCheckbox:checked:after {
            content: '\2714';
            font-size: 28px;
            position: absolute;
            top: -8px;
            left: 2px;
            color: white;
        }


        body {
            background-color: black;
            background-image: url( images/full-map.jpg );
            background-repeat: no-repeat;
            min-width: 1875px;
            min-height: 3860px;
        }

        input {
            position: absolute;
        }

        #reset {
            margin-top: 40px;
            margin-left: 30px;
            padding-top: 4px;
            padding-bottom: 4px;
            width: 100px;
            background-color: white;
            cursor: pointer;
            border: groove 2px gray;
            border-radius: 4px;
            text-align: center;
            font-family: sans-serif;
            font-size: 1.2em;
            font-weight: bold;
        }

        #key {
            position: absolute;
            top: 15px;
            left: 320px;
            border: groove 2px gray;
            background-image: url( images/key.png );
            background-repeat: no-repeat;
            min-width: 238px;
            min-height: 176px;
        }

        #c0 {
            left: 294px;
            top: 259px;
        }
        #c1 {
            left: 762px;
            top: 225px;
        }
    </style>
</head>
<body onload="initializePage();">
    <div id="reset" onclick="resetPage();">Reset</div>
    <div id="key"></div>
</body>
</html>