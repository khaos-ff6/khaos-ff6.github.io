<!DOCTYPE html>
<html>

<!--

Attribution for sound files:
Author  : lonemonk ( https://freesound.org/people/lonemonk/ )
License : http://creativecommons.org/licenses/by/3.0/
.
Converted to .mp3 format using https://www.freeconvert.com/wav-to-mp3

-->

    <head>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script type="text/javascript">
        var defaultColor = "#222266";
        var rotating = false;
        var cycle = 1;
        var rotateInterval = 50;
        var color1R = 0x0;
        var color1G = 0x0;
        var color1B = 0x0;
        var color2R = 0x0;
        var color2G = 0x0;
        var color2B = 0x0;
        var diffR = 0x0;
        var diffG = 0x0;
        var diffB = 0x0;
        var addR = 0x0;
        var addG = 0x0;
        var addB = 0x0;
        var currentR = color1R;
        var currentG = color1G;
        var currentB = color1B;
        var preview = { id : '', joke : '' };
        var voices = [];
        var voiceLoadAttempts = 0;
        
        var jokeLog = JSON.parse( localStorage.getItem( 'jokeLog' ) );
        if ( !jokeLog ) {
            jokeLog = {};
        }

        function setColor( colorString ) {
            document.getElementsByTagName("BODY")[0].style.backgroundColor = colorString;
        }

        function rotateColors() {
            if ( rotating ) {
                currentR += addR;
                currentG += addG;
                currentB += addB;

                if ( cycle == 1 ) {
                    if ( Math.abs( color2R - currentR ) <= Math.abs( addR / 2 )
                        && Math.abs( color2G - currentG ) <= Math.abs( addG / 2 )
                        && Math.abs( color2B - currentB ) <= Math.abs( addB / 2 ) ) {
                            
                        currentR = color2R;
                        currentG = color2G;
                        currentB = color2B;
                        addR *= -1;
                        addG *= -1;
                        addB *= -1;
                        cycle = 2;
                    }
                }
                else {
                    if ( Math.abs( color1R - currentR ) <= Math.abs( addR / 2 )
                        && Math.abs( color1G - currentG ) <= Math.abs( addG / 2 )
                        && Math.abs( color1B - currentB ) <= Math.abs( addB / 2 ) ) {

                        currentR = color1R;
                        currentG = color1G;
                        currentB = color1B;
                        addR *= -1;
                        addG *= -1;
                        addB *= -1;
                        cycle = 1;
                    }
                }

                setColor( getCurrentColor() );
                setTimeout( rotateColors, rotateInterval );
            }
        }

        function toggleRotate() {
            if ( rotating ) {
                rotating = false;
                setColor( defaultColor );
            }
            else {
                rotateInterval = document.getElementById( "interval" ).value;
                getColorsFromInput();
                rotating = true;
                cycle = 1;
                diffR = ( color1R - color2R ) * -1;
                diffG = ( color1G - color2G ) * -1;
                diffB = ( color1B - color2B ) * -1;
                addR = diffR / 20;
                addG = diffG / 20;
                addB = diffB / 20;
                currentR = color1R;
                currentG = color1G;
                currentB = color1B;
                setColor( getCurrentColor() );
                setTimeout( rotateColors, rotateInterval );
            }
        }

        function getCurrentColor() {
            return '#' + hexToStringRep( currentR ) + hexToStringRep( currentG ) + hexToStringRep( currentB );
        }

        function getColorsFromInput() {
            var color1 = document.getElementById( "color1" ).value;
            var color2 = document.getElementById( "color2" ).value;

            if ( color1.substring( 0, 1 ) == "#" ) color1 = color1.substring( 1 );
            if ( color2.substring( 0, 1 ) == "#" ) color2 = color2.substring( 1 );

            if ( color1.length == 3 ) {
                color1R = parseInt( "0x" + color1.substring( 0, 1 ) + "0" );
                color1G = parseInt( "0x" + color1.substring( 1, 2 ) + "0" );
                color1B = parseInt( "0x" + color1.substring( 2 ) + "0" );
            }
            else {
                color1R = parseInt( "0x" + color1.substring( 0, 2 ) );
                color1G = parseInt( "0x" + color1.substring( 2, 4 ) );
                color1B = parseInt( "0x" + color1.substring( 4 ) );
            }

            if ( color2.length == 3 ) {
                color2R = parseInt( "0x" + color2.substring( 0, 1 ) + "0" );
                color2G = parseInt( "0x" + color2.substring( 1, 2 ) + "0" );
                color2B = parseInt( "0x" + color2.substring( 2 ) + "0" );
            }
            else {
                color2R = parseInt( "0x" + color2.substring( 0, 2 ) );
                color2G = parseInt( "0x" + color2.substring( 2, 4 ) );
                color2B = parseInt( "0x" + color2.substring( 4 ) );
            }
        }

        function hexToStringRep( hex ) {
            var leftChar = hexCharIntStringToHexString( Math.trunc( hex / 16 ).toString() );
            var rightChar = hexCharIntStringToHexString( Math.trunc( hex - ( parseInt( "0x" + leftChar ) * 16 ) ).toString() );
            return leftChar + rightChar;
        }

        function hexCharIntStringToHexString( intString ) {
            switch ( intString ) {
                case "10":
                    return "a";
                case "11":
                    return "b";
                case "12":
                    return "c";
                case "13":
                    return "d";
                case "14":
                    return "e";
                case "15":
                    return "f";
                default:
                    return intString;
            }
        }

        function easterEgg() {
            document.getElementById( "easterEgg" ).classList.toggle( "hidden" );
        }

        function colorPreview( inputNum ) {
            if ( inputNum == 1 ) {
                var color1 = document.getElementById( "color1" ).value;
                if ( color1.substring( 0, 1 ) != "#" ) color1 = "#" + color1;
                if ( color1.match( /\#([0-9a-f]{3}|[0-9a-f]{6})$/i ) == null ) {
                    color1 = "#000000";
                }
                document.getElementById( "colorbox1" ).style.backgroundColor = color1;
            }
            else if ( inputNum == 2 ) {
                var color2 = document.getElementById( "color2" ).value;
                if ( color2.substring( 0, 1 ) != "#" ) color2 = "#" + color2;
                if ( color2.match( /\#([0-9a-f]{3}|[0-9a-f]{6})$/i ) == null ) {
                    color2 = "#000000";
                }
                document.getElementById( "colorbox2" ).style.backgroundColor = color2;
            }
        }

        function requestJoke( successCallback ) {
            $.ajax({
                // see https://icanhazdadjoke.com/api for documentation
                url : "https://icanhazdadjoke.com/",
                dataType : "json",
                headers : {
                    Accept : "application/json"
                },
                success: function( result ) {
                    if ( result.status == 200 ) {
                        successCallback();
                    }
                    else {
                        alert( "Dad Joke API Error; Response: " + result.status );
                    }
                }
            });
        }

        // TODO: need to save the joke log to localstorage and re-request a joke when a duplicate is received
        //    - finish implementing requestJoke above
        // localStorage.setItem( 'jokeLog', JSON.stringify( jokeLog ) );
        function getJoke( getPreview = false ) {
            if ( getPreview ) {
                $.ajax({
                    // see https://icanhazdadjoke.com/api for documentation
                    url : "https://icanhazdadjoke.com/",
                    dataType : "json",
                    headers : {
                        Accept : "application/json"
                    },
                    success: function( result ) {
                        if ( result.status == 200 ) {
                            preview.id = result.id;
                            preview.joke = result.joke;
                            alert( preview.joke );
                        }
                        else {
                            alert( "Dad Joke API Error; Response: " + result.status );
                        }
                    }
                })
            }
            else {
                if ( preview.joke != '' ) {
                    $( "#joke" ).text( preview.joke );
                    if ( !rotating ) toggleRotate();
                    readText( preview.joke, playLaugh, 5 );
                    jokeLog[ preview.id ] = true;
                    preview.id = '';
                    preview.joke = '';
                }
                else {
                    $( "#joke" ).text( 'loading...' );
                    $.ajax({
                        url : "https://icanhazdadjoke.com/",
                        dataType : "json",
                        headers : {
                            Accept : "application/json"
                        },
                        success: function( result ) {
                            if ( result.status == 200 ) {
                                $( "#joke" ).text( result.joke );
                                if ( !rotating ) toggleRotate();
                                readText( result.joke, playLaugh, 5 );
                                jokeLog[ result.id ] = true;
                            }
                            else {
                                $( "#joke" ).text( "Dad Joke API Error; Response: " + result.status );
                                if ( rotating ) toggleRotate();
                            }
                        }
                    })
                }
            }
        };

        function randomIntInclusive( min, max ) {
            return Math.floor( Math.random() * ( ( max - min ) + 1 ) + min )
        }

        // I could not get the Chrome voices to load successfully in an onload event for whatever reason, and the loading of them
        // is really buggy; you have to call the getVoices(); function twice, and it can't be in rapid succession (via for loop) or
        // it still doesn't work
        function loadVoices() {
            voices = window.speechSynthesis.getVoices();

            if ( voices.length < 1 && voiceLoadAttempts < 5 ) {
                voiceLoadAttempts++;
                setTimeout( loadVoices, 1000 );
            }
        }

        function readText( text, callback, voiceIndex = -1 ) {
            var msg = new SpeechSynthesisUtterance();
            msg.text = text;
            msg.rate = 0.9;
            if ( callback ) {
                msg.onend = function( event ) { callback(); };
            }
            if ( voiceIndex >= 0 && voices.length ) {
                msg.voice = voices[ voiceIndex ];
            }
            window.speechSynthesis.speak( msg );
        }

        function playLaugh() {
            var audioId = 'a' + randomIntInclusive( 1, 2 );
            document.getElementById( audioId ).play();
        }

        function buttonClick() {
            readText( "Commence hilarity!", getJoke, 6 );
        }

        function viewLog() {
            alert( JSON.stringify( jokeLog ) );
        }

        </script>
        
        <title>Daily Dad Joke</title>

        <style>
            body {
                background-color: #222266;
                color: #ffffff;
                font-size: 16px;
                font-family: sans-serif;
            }

            .content {
                max-width: 800px;
                margin-left: auto;
                margin-right: auto;
                margin-top: 350px;
                text-align: center;
            }

            #title {
                font-size: 24px;
            }

            button {
                display: block;
                margin-left: auto;
                margin-right: auto;
                margin-top: 20px;
            }

            #joke {
                margin-top: 40px;
                font-size: 32px;
            }

            #easterEgg {
                margin-top: 40px;
                margin-left: 250px;
            }

            label {
                float: left;
                clear: left;
                margin-right: 8px;
                margin-bottom: 18px;
            }

            input {
                float: left;
            }

            .colorbox {
                float: left;
                margin-left: 20px;
                height: 30px;
                width: 30px;
                border: 1px solid #ffffff;
            }

            .hidden {
                display: none;
            }

            #viewLog {
                position: fixed;
                top: 0px;
                left: 0px;
                width: 150px;
                height: 150px;
                margin: 0px 0px 0px 0px;
                padding: 0px 0px 0px 0px;
            }
        </style>
    </head>
    <body onload="colorPreview( 1 ); colorPreview( 2 );">
        <div class="content">
            <div id="title">Dad <span onclick="getJoke( true );">Joke</span> of the <span onclick="easterEgg();">Day</span></div>
            
            <button onclick="buttonClick();">Commence Hilarity!</button>

            <div id="joke"></div>

            <div id="easterEgg" class="hidden">
                <label>Rotate Interval:</label><input id="interval" type="text" value="50" />
                <label>Color 1:</label><input id="color1" type="text" value="#222266" onkeyup="colorPreview( 1 );" /><div id="colorbox1" class="colorbox"></div>
                <label>Color 2:</label><input id="color2" type="text" value="#552233" onkeyup="colorPreview( 2 );" /><div id="colorbox2" class="colorbox"></div>
            </div>
        </div>
        <audio id="a1">
            <source src="audio/laughter-only.mp3" type="audio/mpeg">
        </audio>
        <audio id="a2">
            <source src="audio/laughter-and-clapter.mp3" type="audio/mpeg">
        </audio>
        <div id="viewLog" onclick="viewLog();"></div>
    </body>

    <script type="text/javascript">
        loadVoices();
    </script>
</html>